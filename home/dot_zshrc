# ----------------------------------------------------------------------
# Optional profiling module load (currently commented out)
# zmodload zsh/zprof
# https://scriptingosx.com/2019/06/moving-to-zsh-part-2-configuration-files/

# Enable case-insensitive pattern matching for globbing.
setopt NO_CASE_GLOB

# Automatically change to a directory by simply typing its name.
setopt AUTO_CD

# Enable autocorrection for mistyped commands.
setopt CORRECT

# ----------------------------------------------------------------------
# Enable vi-style key bindings for command line editing.
# https://www.techrepublic.com/article/using-vi-key-bindings-in-bash-and-zsh/
# bindkey -v  (this bindkey command is commented out; the option is set via setopt)
setopt vi

# ----------------------------------------------------------------------
# Setup Homebrew path.
# Check if Homebrew is installed in either of the standard locations,
# then add its binary directory to the PATH.
if [ -f /opt/homebrew/bin/brew ]
then
  export PATH="/opt/homebrew/bin:$PATH"
elif [ -f /usr/local/bin/brew ]
then
  export PATH="/usr/local/bin:$PATH"
else
  echo "Homebrew isn't installed"
fi

# ----------------------------------------------------------------------
# Tools Setup Section
# Configure zplug for managing shell plugins.
export ZPLUG_HOME=$(brew --prefix)/opt/zplug
source $ZPLUG_HOME/init.zsh

# Initialize zoxide if installed via Homebrew.
if [ -f $(brew --prefix)/bin/zoxide ]; then
  eval "$(zoxide init zsh)"
fi

# Initialize direnv if installed via Homebrew.
if [ -f $(brew --prefix)/bin/direnv ]; then
  eval "$(direnv hook zsh)"
fi

# Initialize atuin shell integration if installed via Homebrew.
if [ -f $(brew --prefix)/bin/atuin ]; then
  eval "$(atuin init zsh)"
fi

# Load asdf version manager if installed via Homebrew.
if [ -f "$(brew --prefix)/opt/asdf/libexec/asdf.sh" ]; then
  . "$(brew --prefix)/opt/asdf/libexec/asdf.sh"
fi

# Activate mise if it exists locally.
if [ -f "$HOME/.local/bin/mise" ]; then
  eval "$("$HOME/.local/bin/mise" activate zsh)"
fi

# Source fzf shell configuration if the file exists.
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# ----------------------------------------------------------------------
# Initialize Starship prompt.
# You can set the STARSHIP_CONFIG variable to specify your config file.
# export STARSHIP_CONFIG="~/.dotfiles/starship.toml"
eval "$(starship init zsh)"

# ----------------------------------------------------------------------
# PATH additions Section

# Prepend PostgreSQL binaries to PATH if the directory exists.
if [ -d $(brew --prefix)/opt/postgresql/bin ]; then
  export PATH="$(brew --prefix)/opt/postgresql/bin:$PATH"
fi

# Source every file in $HOME/.local/include if the directory exists.
if [ -d $HOME/.local/include ]; then
  for i in $HOME/.local/include/*;
    do source $i
  done
fi

# Prepend the ~/bin directory to PATH if it exists (for custom scripts).
if [ -d ~/bin ]; then
  export PATH=~/bin:$PATH  # add your bin folder to the path, if you have it. It"s a good place to add all your scripts
fi

# Add the current project's bin from the trusted .git/safe folder to PATH.
# (A trick from Thoughtbot Botcave â€“ ensure you have .git/safe in the repository.)
export PATH=".git/safe/../../bin:$PATH"

# ----------------------------------------------------------------------
# Fixes Section

## Tab completion enhancements

# Set up case-insensitive matching for completion.
zstyle ':completion:*' matcher-list 'm:{[:lower:][:upper:]}={[:upper:][:lower:]}' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*'

# Enable partial completion suggestions by initializing completion system.
autoload -Uz compinit && compinit

## History configuration

# Define the history file location (using $ZDOTDIR if set or default to $HOME).
HISTFILE=${ZDOTDIR:-$HOME}/.zsh_history

# Specify maximum number of history entries stored in the file.
HISTSIZE=5000 # file size

# Specify maximum number of history entries for the current session.
SAVEHIST=2000 # session size

# Share history between multiple zsh sessions.
setopt SHARE_HISTORY

# Append new commands to the history file rather than overwriting.
setopt APPEND_HISTORY

# Ignore duplicate commands in history.
setopt HIST_IGNORE_ALL_DUPS

# Optionally expire duplicates before adding new ones.
# setopt HIST_EXPIRE_DUPS_FIRST

# Do not store duplicate commands.
setopt HIST_IGNORE_DUPS

# When searching history, do not show duplicates.
setopt HIST_FIND_NO_DUPS

# Remove blank lines from the history file.
setopt HIST_REDUCE_BLANKS

# Record additional information (timestamps, etc.) in history.
setopt EXTENDED_HISTORY

# ----------------------------------------------------------------------
# Aliases Section

# Informational note:
# Use 'alias -g foo="bar"' for global aliases, and use 'which' to check definitions.

# Fix AUTOCORRECT conflicts for rspec and rubocop commands.
alias rspec="nocorrect rspec"
alias rubocop="nocorrect rubocop"

### Enhancements to Unix commands

# Use 'bat' as an enhanced replacement for 'cat' with a specific theme.
alias cat="bat --theme DarkNeon" # Use '--list-themes' to show all theme options.

# Use 'fd' as a replacement for 'find' (faster and more user-friendly).
alias find="fd"

# Use 'eza' instead of the traditional 'ls' for enhanced listing features.
alias ls="eza"

### Shortcuts for convenience

# Clear the terminal screen.
alias c="clear"

# Display disk space usage in human-readable format.
alias df="df -h"

# List the sizes of folders and files sorted in descending order (top 11).
alias ducks="du -cksh * | sort -rn|head -11"

# Filter history using grep.
alias hist="history 1 | grep"

# Use 'more' for paginated file viewing.
alias m="more"

# Search processes with grep.
alias p="ps xa | grep "

# Show the most used commands based on history.
alias profileme="history | awk '{print \$2}' | awk 'BEGIN{FS=\"|\"}{print \$1}' | sort | uniq -c | sort -n | tail -n 20 | sort -nr"

# Another process searching alias.
alias psgrep="ps aux | grep"

# Use rsync with archive mode, verbose output, and compression.
alias rsync="rsync -avz"

# Show disk usage summary for files and hidden files.
alias space="du -shc * .[^.]*"

# Tail the system log continuously.
alias systail="tail -f /var/log/system.log"

# Use 'less' in follow-mode.
alias t="less +F"

### Suffix aliases
# (Additional suffix aliases can be added here if needed.)
